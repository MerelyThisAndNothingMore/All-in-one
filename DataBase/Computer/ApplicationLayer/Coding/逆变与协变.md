---
tags:
  - programming
aliases:
  - Contravariance and Covariance
---
# 定义
逆变（Contravariance）和协变（Covariance）是类型系统中的两个重要概念，尤其在泛型编程中。它们描述了如何在继承链中安全地使用泛型类型。

## 协变

**定义**：如果类型 `A` 是类型 `B` 的子类型，并且泛型类 `Container<A>` 也是 `Container<B>` 的子类型，那么我们说这个泛型类是协变的。

比如：
```kotlin
class A : B() 

var listA: List<A>
var listB: List<B>

// 这是合法的，由于协变，List<A> : List<B>
listB = listA
```

## 逆变

**定义**：如果类型 `A` 是类型 `B` 的子类型，但泛型类 `Container<B>` 是 `Container<A>` 的子类型，那么我们说这个泛型类是逆变的。

通常应用在函数入参：

```kotlin
open class Fruit
class Apple : Fruit()
class Orange : Fruit()

interface Consumer<in T> {
    fun consume(item: T)
}


class FruitConsumer : Consumer<Fruit> {
    override fun consume(item: Fruit) {
        println("Consumed a fruit!")
    }
}

val appleConsumer: Consumer<Apple> = FruitConsumer()
appleConsumer.consume(Apple())  // 输出 "Consumed a fruit!"


```

定义了一个消费Fruit类Consumer<Fruit>，由于逆变，Apple: Fruit，Consumer<Fruit> : Consumer<Apple>，所以可以用父类变量Consumer<Apple>持有子类变量Consumer<Fruit>。