---
tags: 
aliases:
  - Segmentation Violation
---

# 定义

**SIGSEGV**，全称 Segmentation Violation，是一种信号，表示程序试图访问未被允许的[[内存]]区域时发生的错误。SIGSEGV 是 Unix 和类 Unix [[操作系统]]（包括 [[Linux]]、macOS）中的标准信号，由内核发出，用于指示[[进程]]访问了非法的内存地址。

## 特点

1. **内存访问错误**：
   - SIGSEGV 通常由程序试图访问未分配或受保护的内存区域引起。
   
2. **默认行为**：
   - 当程序接收到 SIGSEGV 信号时，默认行为是立即终止进程并生成一个核心转储（core dump）文件，这个文件可以用于调试。

3. **调试困难**：
   - 段错误可能由多种原因引起，调试起来可能较为复杂，尤其是在大型程序或多[[线程]]环境中。

4. **跨平台存在**：
   - SIGSEGV 是 POSIX 标准的一部分，因此在大多数 Unix-like 操作系统中都存在，包括 Linux、BSD 和 macOS。

## 相似概念辨析

1. **SIGSEGV vs SIGBUS**：
   - SIGSEGV 表示非法内存访问，通常是由于访问未分配的内存或越界访问。SIGBUS 表示总线错误，通常由于对未对齐的内存进行访问或硬件故障引起。

2. **SIGSEGV vs Null Pointer Exception**：
   - SIGSEGV 是操作系统层面的错误，通常由低级语言（如 C/C++）引发。Null Pointer Exception 是高级编程语言（如 Java）中的异常，表示试图通过空指针访问对象。

3. **SIGSEGV vs Stack Overflow**：
   - SIGSEGV 可以由多种非法内存访问引发，包括栈溢出。栈溢出是指程序递归调用过深，超过了栈的最大限制，导致内存访问错误。

# 原理

当程序试图访问非法内存区域时，内存管理单元检测到非法访问，并向该进程发送 SIGSEGV 信号。这种情况通常由以下几种原因引起：

1. **空指针解引用**：
   - 访问一个未初始化或被赋值为 `NULL` 的指针。

2. **越界访问**：
   - [[数组]]越界访问，即访问数组的索引超出了其合法范围。

3. **释放后访问**：
   - 访问已释放的内存区域，即使用了已经通过 `free` 释放的指针。

4. **栈溢出**：
   - [[递归]]调用过深或局部变量过多，超过了栈的最大限制。

5. **无效指针操作**：
   - 使用未正确初始化的指针或指向无效地址的指针。

# 使用与处理

处理 SIGSEGV 信号通常涉及调试和修正程序中的错误。以下是一些调试和处理 SIGSEGV 的方法：

1. **调试工具**：
   - 使用调试器（如 gdb）调试程序，找出发生段错误的位置和原因。

   ```bash
   gdb ./my_program
   (gdb) run
   ```

2. **核心转储**：
   - 启用核心转储，通过核心转储文件分析程序崩溃时的内存状态。

   ```bash
   ulimit -c unlimited
   ./my_program
   gdb ./my_program core
   ```

3. **代码审查**：
   - 检查代码中可能引起段错误的地方，如指针操作、数组访问、递归调用等。

4. **使用内存检查工具**：
   - 使用工具如 Valgrind 来检查程序的内存使用情况，检测潜在的内存访问错误。

   ```bash
   valgrind ./my_program
   ```

# 示例

以下是一个可能引发 SIGSEGV 的简单示例（C 语言）：

```c
#include <stdio.h>

int main() {
    int *ptr = NULL; // 未初始化的指针
    *ptr = 10;       // 尝试通过空指针访问内存
    return 0;
}
```

编译并运行上述代码时，程序会因空指针解引用而触发 SIGSEGV 信号。

# Q & A

1. **什么是 SIGSEGV？**
   - SIGSEGV 是一种信号，表示程序试图访问未被允许的内存区域时发生的错误。

2. **什么情况下会触发 SIGSEGV？**
   - 触发 SIGSEGV 的常见原因包括空指针解引用、数组越界访问、访问已释放的内存、栈溢出和无效指针操作。

3. **如何调试 SIGSEGV 错误？**
   - 可以使用调试器（如 gdb）、启用核心转储、代码审查和内存检查工具（如 Valgrind）来调试和修正 SIGSEGV 错误。

通过理解 SIGSEGV 的定义、特点、原理和处理方法，可以更有效地调试和修正程序中的内存访问错误，提高程序的稳定性和可靠性。