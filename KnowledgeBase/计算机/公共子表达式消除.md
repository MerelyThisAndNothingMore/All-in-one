---
tags: 
alias:
---

# 定义

公共子表达式消除（Common Subexpression Elimination, CSE）是一种[[编译器]]优化技术，旨在识别和消除程序中多次出现的相同子表达式，从而减少冗余计算，提高代码执行效率。通过这种优化，编译器可以减少重复计算相同结果的操作，优化资源使用，提高程序性能。

## 特点

1. **减少冗余计算**：
   - CSE 通过识别并消除重复计算的子表达式，减少不必要的计算操作，从而提高程序运行效率。

2. **提高代码效率**：
   - 通过消除重复计算，CSE 可以显著减少指令执行次数和资源占用，提高代码执行效率。

3. **节省内存和寄存器**：
   - 由于减少了重复计算，CSE 可以减少临时变量的使用，优化内存和寄存器的使用。

4. **编译器自动优化**：
   - 现代编译器通常会自动应用 CSE 优化，开发者无需手动干预，从而简化代码优化过程。

## 相似概念辨析

1. **公共子表达式消除 vs. 常量折叠**：
   - 常量折叠（Constant Folding）是另一种编译器优化技术，用于在编译时计算表达式中的常量值，从而消除运行时的计算。CSE 则是识别并消除代码中重复出现的相同子表达式。

2. **公共子表达式消除 vs. 循环不变代码外提**：
   - 循环不变代码外提（Loop-Invariant Code Motion）是将循环中不变的代码移出循环体，以减少不必要的重复执行。CSE 则是识别并消除整个程序中多次出现的相同子表达式。

# 原理

公共子表达式消除的基本原理是通过分析代码中的表达式，找到多次出现的相同子表达式，并将其计算结果存储在临时变量中，后续再用到时直接使用该临时变量，从而避免重复计算。

1. **识别公共子表达式**：
   - 编译器扫描代码，识别出多次出现且计算结果相同的子表达式。

2. **存储计算结果**：
   - 将第一次计算的结果存储在一个临时变量中。

3. **替换重复表达式**：
   - 用临时变量替换后续出现的相同子表达式，从而消除重复计算。

# 使用

公共子表达式消除主要在编译器优化阶段自动完成。开发者通常无需手动进行 CSE 优化，但可以通过编写高效的代码来间接促进编译器的优化效果。

## 示例

假设有以下代码片段：

```java
int a = b + c;
int d = b + c + e;
```

在这个例子中，表达式 `b + c` 出现了两次，可以使用 CSE 进行优化：

1. **识别公共子表达式**：
   - 表达式 `b + c` 在代码中多次出现。

2. **存储计算结果**：
   - 将 `b + c` 的计算结果存储在一个临时变量中。

3. **替换重复表达式**：
   - 用临时变量替换后续出现的相同子表达式。

优化后的代码如下：

```java
int temp = b + c;
int a = temp;
int d = temp + e;
```

通过这种优化，可以减少一次 `b + c` 的计算，提高代码执行效率。

## 在编译器中的应用

现代编译器（如 GCC、Clang、[[Java]] 的 [[HotSpot]] 编译器等）通常会在优化阶段自动应用 CSE 技术，优化代码执行效率。例如，在 Java 中，[[Java 虚拟机|JVM]] 的即时编译器（JIT）会在运行时动态分析和优化字节码，包括应用公共子表达式消除技术。

# 总结

公共子表达式消除是一种重要的编译器优化技术，通过识别并消除程序中多次出现的相同子表达式，减少冗余计算，提高代码执行效率。尽管这种优化通常由编译器自动完成，但开发者了解其原理和特点，可以编写更高效的代码，从而间接促进编译器的优化效果。