---
tags: 
alias:
---

# 定义

函数指针是指向函数的[[指针]]。在[[C]]和[[C++]][[编程语言]]中，函数指针可以保存和调用函数的地址，使得程序能够动态地选择和执行函数。函数指针不仅可以用于简单的函数调用，还可以用于实现回调函数、动态调度和函数表等高级功能。

## 特点

1. **动态调用**：
   - 函数指针允许在运行时动态地选择和调用函数，而不是在编译时就确定。
   
2. **灵活性**：
   - 通过函数指针，可以实现灵活的代码结构，如回调机制、状态机和策略模式等。
   
3. **函数表**：
   - 函数指针可以用来创建函数表，方便实现类似虚函数表的功能，特别是在没有[[面向对象]]支持的语言中。
   
4. **节省内存**：
   - 使用函数指针可以避免冗余代码，节省内存开销。

## 相似概念辨析

1. **函数指针 vs 普通指针**：
   - 普通指针指向数据（如变量或数组），而函数指针指向函数。
2. **函数指针 vs 函数引用**：
   - 在C++中，函数引用（function reference）也是一种函数调用方式，但与函数指针不同，函数引用不能重新指向另一个函数。
3. **函数指针 vs 面向对象中的多态**：
   - 面向对象中的多态通过[[虚函数]]表实现，函数指针可以实现类似的功能，但没有面向对象的[[封装]]和[[继承]]特性。

# 原理

函数指针的原理是将函数的地址存储在指针变量中，通过该指针变量可以调用对应的函数。函数指针的声明和使用包括以下几个步骤：

1. **声明函数指针**：
   - 函数指针的声明语法与函数原型相似，只是将函数名替换为指针变量。
   
   ```c
   // 声明一个指向返回类型为 int，参数为 (int, int) 的函数的指针
   int (*funcPtr)(int, int);
   ```

2. **赋值给函数指针**：
   - 将一个函数的地址赋值给函数指针。
   
   ```c
   // 定义一个函数
   int add(int a, int b) {
       return a + b;
   }

   // 将函数地址赋值给函数指针
   funcPtr = &add;
   ```

3. **通过函数指针调用函数**：
   - 使用函数指针调用函数，就像使用函数名调用函数一样。
   
   ```c
   // 通过函数指针调用函数
   int result = funcPtr(2, 3);  // result = 5
   ```

# 使用

函数指针在实际编程中有广泛的应用，以下是一些常见的使用场景：

1. **回调函数**：
   - 在需要异步处理或事件驱动编程时，使用函数指针实现回调函数。
   
   ```c
   // 回调函数类型
   typedef void (*Callback)(int);

   void registerCallback(Callback cb) {
       // 调用回调函数
       cb(42);
   }
   ```

2. **函数表**：
   - 在实现状态机或命令模式时，使用函数指针[[数组]]或函数表实现动态调度。
   
   ```c
   // 函数指针数组
   int (*operations[2])(int, int) = {add, subtract};

   // 动态选择函数
   int result = operations[0](5, 3);  // 调用 add 函数
   ```

3. **动态库函数调用**：
   - 在动态加载库文件（如DLL或SO文件）时，通过函数指针调用库中的函数。
   
   ```c
   // 动态加载库并获取函数地址
   void* handle = dlopen("libm.so", RTLD_LAZY);
   double (*cosine)(double) = dlsym(handle, "cos");

   // 调用动态库中的函数
   double result = cosine(0.5);
   ```

# Q & A

1. **函数指针的用途是什么？**
   - 函数指针主要用于动态调用函数、实现回调机制、创建函数表和动态库函数调用等。

2. **如何声明和使用函数指针？**
   - 声明函数指针时需要指定函数的返回类型和参数类型，然后将函数地址赋值给指针变量，通过指针变量调用函数。

3. **函数指针与普通指针有何不同？**
   - 普通指针指向数据（如变量或数组），函数指针指向函数，允许动态调用函数。

4. **函数指针在面向对象编程中有哪些替代方案？**
   - 在面向对象编程中，可以使用虚函数和多态性来实现类似的功能，提供更高层次的抽象和封装。

通过理解函数指针的定义、特点、原理和实际应用，可以在编程中灵活地使用这一强大的工具，提高代码的灵活性和可维护性。
